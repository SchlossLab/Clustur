<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>clustur • clustur</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="clustur">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clustur</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/clustur.html">clustur</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SchlossLab/Clustur/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>clustur</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SchlossLab/Clustur/blob/master/vignettes/clustur.Rmd" class="external-link"><code>vignettes/clustur.Rmd</code></a></small>
      <div class="d-none name"><code>clustur.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.schlosslab.org/Clustur/">clustur</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="starting-up">Starting Up<a class="anchor" aria-label="anchor" href="#starting-up"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install via cran</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"clustur"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install via github</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"SchlossLab/Clustur"</span><span class="op">)</span></span></code></pre></div>
<p>clustur was developed to be similar to the <a href="https://mothur.org" class="external-link">mothur implementation</a> that was written in
C++, however there are a few differences to note. In order to cluster
your data, we are requiring users to build out there own sparse matrix
(we also support phylip files) and count table in R or mothur. Once
these objects are built out you can call the cluster function. We
currently support 5 cluster methods from mothur: furthest, nearest,
weighted, and average neighbor and opticlust, which is mothur’s default.
Each of these methods will produce data comparable to mothur. The speed
of the clustur and mothur are comparable. Below we will show you how to
create your sparse matrix and count table. If you do not have a count
table, clustur can produce one from you, but it will assume the
abundance of each sequence is one and it will only cluster the sequences
in the distance matrix.</p>
<div class="section level3">
<h3 id="read-count-files">Read count files<a class="anchor" aria-label="anchor" href="#read-count-files"></a>
</h3>
<p>mothur used to produce a tabular count table and now produces a
compressed verion, clustur will read both formats and figure out which
you have…</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_count.html">read_count</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon.count_table"</span><span class="op">)</span><span class="op">)</span> <span class="co">#should be a tsv or mothur-native count file</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_table_sparse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_count.html">read_count</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"count_table.sparse.count_table"</span><span class="op">)</span><span class="op">)</span> <span class="co">#should be a tsv or mothur-native count file</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-distance-matrix-file">Read distance matrix file<a class="anchor" aria-label="anchor" href="#read-distance-matrix-file"></a>
</h3>
<p>mothur produces <a href="https://mothur.org/wiki/column-formatted_distance_matrix/" class="external-link">column/sparse
distance matrix</a> and <a href="https://mothur.org/wiki/phylip-formatted_distance_matrix/" class="external-link">Phylip-formatted
distance matrix files</a>. clustur will read both formats and will
figure out which you have.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distance_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_dist.html">read_dist</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon_column.dist"</span><span class="op">)</span>, <span class="va">count_table</span>, cutoff <span class="op">=</span> <span class="fl">0.03</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; This is a column file. Processing now...</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distance_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_dist.html">read_dist</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon_phylip.dist"</span><span class="op">)</span>, <span class="va">count_table</span>, cutoff <span class="op">=</span> <span class="fl">0.03</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; This is a phylip file. Processing now...</span></span></code></pre></div>
<p>The return value of <code>distance_data</code> will be a memory
address. If you want a data frame version of the distances, you can use
<code>get_distances(distance_data)</code>.</p>
</div>
<div class="section level3">
<h3 id="cluster-data">Cluster data<a class="anchor" aria-label="anchor" href="#cluster-data"></a>
</h3>
<ul>
<li>opticlust is the default</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">distance_data</span>, method <span class="op">=</span> <span class="st">"opti"</span><span class="op">)</span> <span class="co"># this needs to make sure that dist_data and count_table are compatible</span></span></code></pre></div>
<div class="section level4">
<h4 id="selecting-different-clustering-methods">Selecting different clustering methods<a class="anchor" aria-label="anchor" href="#selecting-different-clustering-methods"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">distance_data</span>, method <span class="op">=</span> <span class="st">"furthest"</span><span class="op">)</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">distance_data</span>, method <span class="op">=</span> <span class="st">"nearest"</span><span class="op">)</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">distance_data</span>, method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">distance_data</span>, method <span class="op">=</span> <span class="st">"weighted"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="output-data-from-clustering">Output data from clustering<a class="anchor" aria-label="anchor" href="#output-data-from-clustering"></a>
</h3>
<p>All methods produce a list object with an indicator of the cutoff
that was used (<code>cutoff</code>), as well as cluster
(<code>clusters</code>) and shared (<code>shared</code>) data frames.
The <code>clusters</code> data frame shows how each sequence cluster
together with a column for the cluster identifiers
(<code>cluster</code>) and a column of lists indicating the identifiers
within each cluster (<code>identifiers</code>). The <code>shared</code>
data frame contains columns indicating the <code>cluster</code> and the
<code>sample</code> identifiers and the abundance of each cluster in
each sample; the <code>cluster</code> identifier in the
<code>shared</code> data frame is the same as that in the
<code>clusters</code> data frame. The <code>metrics</code> data frame.
The OptiClust method also includes the <code>metrics</code> data frame,
which describe the optimization value for each iteration in the fitting
process; the data in <code>clusters</code> and <code>shared</code> are
taken from the last iteration. clustur provides getter functions,
<code><a href="../reference/get_cutoff.html">get_cutoff()</a></code>, <code><a href="../reference/get_clusters.html">get_clusters()</a></code>,
<code><a href="../reference/get_shared.html">get_shared()</a></code>, and <code><a href="../reference/get_metrics.html">get_metrics()</a></code>, which will be
demonstrated below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">distance_data</span>, method <span class="op">=</span> <span class="st">"opti"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_cutoff.html">get_cutoff</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03</span></span>
<span><span class="fu"><a href="../reference/get_clusters.html">get_clusters</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt;       label                        bins   otu</span></span>
<span><span class="co">#&gt; 85 0.030000 U68618,U68638,U68658,U68620 otu85</span></span>
<span><span class="co">#&gt; 88 0.030000 U68663,U68688,U68679,U68665 otu88</span></span>
<span><span class="co">#&gt; 87 0.030000        U68641,U68673,U68667 otu87</span></span>
<span><span class="co">#&gt; 84 0.030000               U68615,U68680 otu84</span></span>
<span><span class="co">#&gt; 86 0.030000               U68631,U68636 otu86</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 83 rows ]</span></span>
<span><span class="fu"><a href="../reference/get_shared.html">get_shared</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt;      label  samples  otu abundance</span></span>
<span><span class="co">#&gt; 1 0.030000 no_group OTU1         1</span></span>
<span><span class="co">#&gt; 2 0.030000 no_group OTU2         1</span></span>
<span><span class="co">#&gt; 3 0.030000 no_group OTU3         1</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 85 rows ]</span></span>
<span><span class="fu"><a href="../reference/get_metrics.html">get_metrics</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt; $metrics</span></span>
<span><span class="co">#&gt;      label   cutoff specificity      ppv       ttp  f1score          tn</span></span>
<span><span class="co">#&gt; 1 0.030000 0.030000    1.000000 1.000000 17.000000 1.000000 4736.000000</span></span>
<span><span class="co">#&gt;        mcc       fn       fp sensitivity      npv      fdr accuracy</span></span>
<span><span class="co">#&gt; 1 1.000000 0.000000 0.000000    1.000000 1.000000 1.000000 1.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $other_metrics</span></span>
<span><span class="co">#&gt;      mcc accuracy fdr iter cutoff specificity ppv time f1score tn label tp</span></span>
<span><span class="co">#&gt;      num_otus fn fp sensitivity npv</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 3 rows ]</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Johnson, Patrick Schloss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
